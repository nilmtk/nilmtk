
# Submit a bug report

Please use our [github issue queue](https://github.com/nilmtk/nilmtk/issues) to submit bug reports, rather than emailing them.  Submitting to the issue queue means that anyone in the community can comment and benefit from the discussion.  If your bug concerns one of NILMTK's dependencies then please contact the relevant project directly.

Before opening an issue:

1. Search the issue queue in case a duplicate already exists
2. Pull the latest changes from the repository master branch to see if the error goes away (i.e. run `git pull` in your local NILMTK directory)

If not, please open a new issue, ensuring:

* The title summarises the issue
* The issue is described briefly in prose
* A minimal snippet of code is included which will allow us to recreate the bug.  Please use github's pretty formatting for your code.  For example, if you put this in your issue:

		```python
		print("hello")
		```

Then this will be rendered:
```python
print("hello")
```

* A copy-paste of the *entire* stack dump produced by the error
* Please run this in Python:
```python
from nilmtk.utils import show_versions
show_versions()
```
  And copy-and-paste the output of `show_versions()` into your issue.


# Code style

We're aiming to mimic the wonderful scikit-learn so we plan to adopt [their coding guidelines](http://scikit-learn.org/stable/developers/#coding-guidelines).  It's basically [PEP8](http://www.python.org/dev/peps/pep-0008/) with [numpy docstrings](https://numpydoc.readthedocs.io/en/latest/format.html#docstring-standard).


# Contribute code or documentation

The basic process to contribute a modification or new code or documentation is to:

1. Fork the main NILMTK project on github to your own github account.
2. Clone your forked version of NILMTK to your development machine.
3. Create a new git branch using `git switch -c <branch name>`.  For example, if you are submitting a fix for issue 123 then create a new branch called 'fix_issue_123' by running `git switch -c fix_issue_123`.  Please ensure all the modifications in a branch are *specific* to the issue you are trying to fix or the feature your are adding.
4. If you are working on addressing a specific issue then please post to the issue queue just before you start work to make sure no one else wastes their time trying to fix the same issue at the same time! 
5. Make your modifications.
6. Ideally, please also create a unittest which demonstrates an existing bug (i.e. create a test which fails and your aim is to modify NILMTK so the test passes) or, if you are adding a new feature, please add a test for it.
7. Run `nosetests` to make sure you haven't broken anything. 
8. Commit to your new branch.  Push to your forked version of NILMTK on github.  You can make multiple commits to the same branch if necessary.
9. Issue a pull request to the main NILMTK project.  If you need to make more changes before the PR is accepted then just push new commits to your branch.

For more info, see ['How to Collaborate On GitHub' on TutsPlus](http://code.tutsplus.com/tutorials/how-to-collaborate-on-github--net-34267)


# Contribute documentation

The vast majority of our documentation is in [IPython notebooks](http://ipython.org/notebook.html).  We *only* use [Sphinx](http://sphinx-doc.org) to render NILMTK's Python docstrings as HTML.


### IPython notebooks

To modify one of NILMTK's existing IPython notebooks, please clone NILMTK to your computer and then run `ipython notebook` from your operating system's shell in the `nilmtk/notebooks/manual` directory.  You will need to install IPython 3.0 or higher.  Please use IPython's HTML notebook viewer, not the QT notebook viewer.



### Sphinx
We *only* use [Sphinx](http://sphinx-doc.org) to render NILMTK's Python docstrings as HTML.  To update the HTML files generated by Sphinx:

Firstly, we clone the main `nilmtk` repository::

```bash
cd ~
git clone https://github.com/nilmtk/nilmtk/
```

`nilmtksite` would contain all the content which gets uploaded to nilmtk.github.io, including sphinx content::

```bash
git clone https://github.com/nilmtk/nilmtk.github.io nilmtksite
```

Now, move back to the main repository::

```bash
cd ~/nilmtk
```

As usual make changes to `.rst` files in `~/nilmtk/docs/source` to contribute to documentation. 

Build your documentation::

```bash
make -C ~/nilmtk/docs html
```

Now, built documentation should lie in `~/nilmtksite/html` directory. You can use your browser to check if everything got built properly.

Commit your changes and push to ``nilmtk``. And then commit all your changes to ``nilmtksite``. Thats all!


### Render docstrings as HTML using sphinx-apidoc

We use [sphinx-apidoc](http://sphinx-doc.org/man/sphinx-apidoc.html) to automatically generate render the Python docstrings from NILMTK's code as HTML.  We call this our 'API docs'. Run this code from the root nilmtk directory to regenerate the API docs:

```bash
/nilmtk$ sphinx-apidoc -f -o docs/source nilmtk
```

### Run Sphinx on Windows

Please see [Graham's notes for building NILMTK's documentation on Windows](https://github.com/nilmtk/nilmtk/issues/388#issuecomment-107220362).


   
# Conda builds on Travis-CI

Starting in the version 0.4 development, NILMTK uses automated package builds on Travis CI for a fast development pace and allow users to install preview/incomplete releases. Conda packages are built only when a Git tag is present.

The current logic, which can be improved, is that Git tags that contain the "dev" substring will trigger a build that is labelled `dev` in Anaconda cloud. If the "dev" substring is not found in the Git tag, the package is uploaded with the "main" label. A tag that is not a valid version string should result in an error while running `conda-build`.
For example, tagging a commit with 0.4.0.dev0 will trigger a dev build, while simply 0.4.0 will trigger a normal package release.

To install from the `dev` label, you need to specify the channel as follows:

	```bash
    conda install -c conda-forge -c nilmtk -c nilmtk/label/dev nilmtk
	```
